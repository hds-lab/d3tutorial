<!DOCTYPE html><html class="full-page"><head><meta charset="utf8"/><title>D3 Workshop</title><link rel="stylesheet" href="http://scclab.github.io/d3tutorial/css/global.css"/><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans|Source+Code+Pro"/><link rel="stylesheet" href="http://scclab.github.io/d3tutorial/vendor/jquery.splitter/jquery.splitter.css"><link rel="stylesheet" href="http://scclab.github.io/d3tutorial/js/prism/prism.css"></head><body><header><nav role="navigation" class="navbar navbar-inverse navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><button data-toggle="collapse" data-target="#navbar-top-collapse-1" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="http://scclab.github.io/d3tutorial/" class="navbar-brand">D3 Workshop</a></div><div id="navbar-top-collapse-1" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="http://scclab.github.io/d3tutorial/help.html">Instructions</a></li><li><a href="https://github.com/mbostock/d3/wiki/API-Reference" target="_blank">D3 Docs</a></li><li><a href="https://github.com/mbostock/d3/wiki/Gallery" target="_blank">D3 Gallery</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" target="_blank">JS Docs</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/SVG" target="_blank">SVG Docs</a></li></ul></div></div></nav></header><main class="tutorial"><div class="split-panel"><div class="left-col"><div class="tutorial-label"><span>Tutorial Instructions</span></div><div class="container-fluid"><article><h1>Visualizing the Cars Data</h1>
<p>In this tutorial we will build a colorful scatter-plot-style visualization.
We will use four dimensions from the Cars dataset, encoded as x and y position, size, and color.</p>
<h2>The Cars Dataset</h2>
<p>The &quot;Cars&quot; dataset used in this tutorial is a subset
of the 1983 ASA Data Exposition dataset that is used in the <a href="http://courses.washington.edu/hcde511/">HCDE 511</a> course.</p>
<p>You can <a href="resources/cars/carsExercise.xls">download the data</a> in Excel format, although
it is not necessary to complete the tutorial.</p>
<p>Every row in the data represents an individual type of car.
The dataset includes the following fields:</p>
<ul>
<li>Model: the car&#39;s model name</li>
<li>Origin: the country where the car is from</li>
<li>Year: the year the car was manufactured</li>
<li>Cylinders: the number of cylinders in the car&#39;s engine</li>
<li>Horsepower: how powerful the car&#39;s engine is</li>
<li>MPG: how many miles per gallon the car gets (fuel efficiency)</li>
<li>Weight: how much the car weighs, in lbs.</li>
</ul>
<h2>Visual Encodings</h2>
<p>We will create a visualization of four of these fields.
The visual encodings are illustrated in the diagram below:</p>
<p><img src="resources/cars/visual_encodings.png" alt="Visual encodings"></p>
<p>Here is a screenshot of the final visualization:</p>
<p><img src="resources/cars/cars_visualization.png" alt="Final cars visualization"></p>
<h2>1. Initial Setup</h2>
<p>We&#39;ll skip over some of the basic setup for the visualization,
which we already covered in other tutorials.
Here are the steps we are skipping:</p>
<ol>
<li>Importing the data from the CSV.</li>
<li>Creating the SVG element.</li>
<li>Defining scales for the data fields.</li>
<li>Drawing the chart axes.</li>
</ol>
<p><a class="btn btn-primary jsbin-button" href="http://jsbin.com/xexezo/8/edit?js,output" target="_blank">Open Initial Setup in JS Bin</a></p>
<p>You can review the code for these in the JavaScript panel to the right, if you wish.
We have also provided some CSS to make the chart look nice, but we won&#39;t go into it here.</p>
<h2>2. Draw some dots</h2>
<p>Our first step will be to render a dot for each car, using SVG <code>&lt;circle&gt;</code> elements.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/circle">More about circles</a></p>
<p>First, we select all of the elements with class &#39;dot&#39; (they are theoretical
dat this point) and bind the cars data to them.</p>
<p>Add the following code to the bottom of the JavaScript in JS Bin:</p>
<pre><code class="language-javascript">var dots = chart.selectAll(&#39;.dot&#39;)
                .data(data);</code></pre>
<p>Next, use the D3 data join function <code>enter()</code>
to create a dot for every dot that doesn&#39;t yet exist.
For the cars data, this means 26 dots.</p>
<pre><code class="language-javascript">dots.enter()
    .append(&quot;circle&quot;)
    .attr(&quot;class&quot;, &quot;dot&quot;)
    .append(&quot;title&quot;);</code></pre>
<p><em>Note that we also added an SVG <code>&lt;title&gt;</code> element inside each dot,
which we will use later to show a tooltip.</em></p>
<p>This doesn&#39;t do anything in our visualization, but
it is normal at this point to also remove any dots that you don&#39;t need:</p>
<pre><code class="language-javascript">dots.exit().remove();</code></pre>
<p>Now there are dots being rendered, but they don&#39;t look like anything.
They have default size, color, and position.</p>
<p><a class="btn btn-primary jsbin-button" href="http://jsbin.com/xexezo/9/edit?js,output" target="_blank">Open in JS Bin</a></p>
<h2>Mapping to visual attributes</h2>
<p>To actually see our dots, we need to set their position, size,
and color.</p>
<p>To do this, we just add the following code:</p>
<pre><code class="language-javascript">dots.attr(&quot;r&quot;, function(d) { return radius(d.weight); })
    .attr(&quot;cx&quot;, function(d) { return x(d.horsepower); })
    .attr(&quot;cy&quot;, function(d) { return y(d.mpg); })
    .style(&quot;fill&quot;, function(d) { return color(d.origin); });</code></pre>
<p>In the initial setup, we prepared several D3 &quot;scale&quot; objects
that we are using here (<code>radius</code>, <code>x</code>, <code>y</code>, and <code>color</code>).
You can scroll up through the JavaScript to find how
these are defined.</p>
<p><a class="btn btn-primary jsbin-button" href="http://jsbin.com/xexezo/4/edit?js,output" target="_blank">Open in JS Bin</a></p>
<h2>Adding a legend</h2>
<p>The chart as is stands is pictured below:</p>
<p><img src="resources/cars/no_legend.png" alt="Chart without legend"></p>
<p>This is all very nice, but how is a user to know what is meant by size and color?
To make things more clear, we&#39;ll now add a legend to the chart, in the upper
right corner. Here&#39;s what we&#39;re going for:</p>
<p><img src="resources/cars/origins_legend.png" alt="Legend for car origin"></p>
<p>We are going to use D3 to build this legend dynamically from some data,
just like we are doing with our actual visualization.</p>
<p>The data for the &quot;legend visualization&quot; will be the list of
car origins (<code>[&#39;US&#39;, &#39;Japan&#39;, &#39;Europe&#39;]</code>), which we can obtain
by calling <code>color.domain()</code> because origins are the domain
for our color scale.</p>
<p>We&#39;ll build up the legend in stages. First,
add the following code:</p>
<pre><code class="language-javascript">var origins = chart.selectAll(&quot;.legend.origin&quot;)
  .data(color.domain())
  .enter().append(&quot;g&quot;)
  .attr(&quot;class&quot;, &quot;legend origin&quot;)
  .attr(&quot;transform&quot;,
        function(d, i) { return &quot;translate(0,&quot; + i * 20 + &quot;)&quot;; });</code></pre>
<p>This joins the list of car origins to a &quot;theoretical&quot;
set of <code>.legend</code> and <code>.origin</code> elements.
Because these elements don&#39;t exist yet,
they will be created.
We also offset (translate) each part of the legend
by about 20 pixels so that they don&#39;t all appear on top of each other.</p>
<p>Now we have a bunch of empty and invisible <code>&lt;g&gt;</code> elements with
their class attribute set to &#39;legend origin&#39;.
The code below attaches a rectangle of the appropriate color to each
one of these <code>&lt;g&gt;</code> elements:</p>
<pre data-line="5"><code class="language-javascript">origins.append("rect")
      .attr("x", graphWidth - 18)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);
</code></pre>

<p>Finally, we will use similar code to add the text labels:</p>
<pre data-line="6"><code class="language-javascript">origins.append("text")
      .attr("x", graphWidth - 24)
      .attr("y", 9)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d; });
</code></pre>

<p>A lot of that was just moving stuff around to make it look good.
The highlighted <code>.style()</code> the <code>.text()</code> lines are what
actually produce the color and text labels from the car origins data.</p>
<p><a class="btn btn-primary jsbin-button" href="http://jsbin.com/xexezo/5/edit?js,output" target="_blank">Open in JS Bin</a></p>
<h2>Another legend</h2>
<p>We also want to clearly explain what the size of dots means.
This mostly similar to the legend above:</p>
<pre><code class="language-javascript">var legendOffset = origins.size() * 20 + 5;

//Add a legend for radius/weight
var weights = chart.selectAll(&#39;.legend.weight&#39;)
  .data(range.weight)
  .enter().append(&#39;g&#39;)
  .attr(&#39;class&#39;, &#39;legend weight&#39;)
  .attr(&#39;transform&#39;, function(d, i) { return &quot;translate(0, &quot; + (legendOffset + i * 20) + &quot;)&quot;; });

weights.append(&quot;circle&quot;)
      .attr(&quot;cx&quot;, graphWidth - 9)
      .attr(&quot;cy&quot;, 10)
      .attr(&quot;r&quot;, radius)
      .style(&quot;fill&quot;, &#39;gray&#39;);

weights.append(&quot;text&quot;)
      .attr(&quot;x&quot;, graphWidth - 24)
      .attr(&quot;y&quot;, 9)
      .attr(&quot;dy&quot;, &quot;.35em&quot;)
      .style(&quot;text-anchor&quot;, &quot;end&quot;)
      .text(function(d) { return d + &quot; lbs&quot;; });</code></pre>
<p>The only new thing here is that we have added a <code>legendOffset</code> to start
drawing this legend below the first legend.</p>
<p><a class="btn btn-primary jsbin-button" href="http://jsbin.com/xexezo/10/edit?js,output" target="_blank">Open in JS Bin</a></p>
</article></div><div class="tutorial-nav"><ul class="nav"></ul></div></div><div class="right-col"><div class="jsbin-placeholder"><p class="lead">JS Bin Loading...</p></div><div class="jsbin-container"></div></div></div></main><script src="http://scclab.github.io/d3tutorial/vendor/jquery/jquery.min.js"></script><script src="http://scclab.github.io/d3tutorial/vendor/bootstrap/js/bootstrap.min.js"></script><script src="http://scclab.github.io/d3tutorial/vendor/jquery.splitter/jquery.splitter.js"></script><script src="http://scclab.github.io/d3tutorial/vendor/jquery.cookie/jquery.cookie.js"></script><script src="http://scclab.github.io/d3tutorial/js/prism/prism.js"></script><script src="http://scclab.github.io/d3tutorial/js/tutorials/jsbin.js"></script><script src="http://scclab.github.io/d3tutorial/js/tutorials/embed.js"></script></body></html>